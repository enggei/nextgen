{
  "uuid" : "483489b9-c91a-41c8-ad49-1dc7f9f1469f",
  "name" : "Nextgen",
  "delimiter" : "~",
  "templates" : [ {
    "uuid" : "76d29786-6c58-46af-b1bd-9d49ed4bb8a9",
    "name" : "TreeNavigator",
    "text" : "package ~packageName~;\n\nimport nextgen.utils.SwingUtil;\n~imports:{it|import ~it~;};separator=\"\\n\"~\n\nimport javax.swing.*;\nimport javax.swing.tree.*;\nimport java.awt.*;\nimport java.awt.event.*;\nimport java.util.List;\nimport java.util.*;\nimport java.util.function.Consumer;\n\npublic class ~name~ extends JPanel {\n\n\tprivate final static org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(~name~.class);\n\n\tprivate final JTree tree = new JTree();\n\tprivate final STAppPresentationModel presentationModel;\n\tprivate final DefaultTreeModel treeModel;\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\tpublic ~name~(STAppPresentationModel presentationModel~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper(new BorderLayout());\n\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t\t\n\n\t\tthis.presentationModel = presentationModel;\n\n\t\ttreeModel = new DefaultTreeModel(~rootNodeExpression~);\n\t\ttree.setModel(treeModel);\n\t\tToolTipManager.sharedInstance().registerComponent(tree);\n\n\t\ttree.setCellRenderer(new DefaultTreeCellRenderer() {\n\n\t\t\t@Override\n\t\t\tpublic Component getTreeCellRendererComponent(JTree tree, Object value, boolean sel, boolean expanded, boolean leaf, int row, boolean hasFocus) {\n\t\t\t\tfinal boolean isBaseTreeNode = value instanceof BaseTreeNode;\n\t\t\t\tif (isBaseTreeNode) {\n\t\t\t\t\tfinal BaseTreeNode<?> baseTreeNode = (BaseTreeNode<?>) value;\n\t\t\t\t\tfinal ImageIcon icon = baseTreeNode.getIcon();\n\t\t\t\t\tsetIcon(icon);\n\t\t\t\t\tsetOpenIcon(icon);\n\t\t\t\t\tsetClosedIcon(icon);\n\t\t\t\t\tsetLeafIcon(icon);\n\t\t\t\t\tsetToolTipText(baseTreeNode.getTooltip());\n\t\t\t\t\treturn super.getTreeCellRendererComponent(tree, baseTreeNode.getLabel(), sel, expanded, leaf, row, hasFocus);\n\t\t\t\t}\n\t\t\t\treturn super.getTreeCellRendererComponent(tree, value, sel, expanded, leaf, row, hasFocus);\n\t\t\t}\n\t\t});\n\n\t\ttree.addMouseListener(new MouseAdapter() {\n\t\t\t@Override\n\t\t\tpublic void mouseClicked(MouseEvent e) {\n\t\t\t\tif (SwingUtilities.isRightMouseButton(e)) {\n\n\t\t\t\t\tfinal TreePath selectionPath = tree.getPathForLocation(e.getX(), e.getY());\n\t\t\t\t\tif (selectionPath == null) return;\n\t\t\t\t\tfinal Object lastPathComponent = selectionPath.getLastPathComponent();\n\t\t\t\t\tif (!(lastPathComponent instanceof BaseTreeNode<?>)) return;\n\n\t\t\t\t\tshowPopup((BaseTreeNode<?>) lastPathComponent, e.getX(), e.getY());\n\t\t\t\t\n\t\t\t\t} else {\n\n\t\t\t\t\tfinal TreePath selectionPath = tree.getPathForLocation(e.getX(), e.getY());\n\t\t\t\t\tif (selectionPath == null) return;\n\t\t\t\t\tfinal Object lastPathComponent = selectionPath.getLastPathComponent();\n\t\t\t\t\tif (!(lastPathComponent instanceof BaseTreeNode<?>)) return;\n\n\t\t\t\t\t~onSelectionStatements:{it|~it~};separator=\"\\n\"~\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\ttree.addKeyListener(new KeyAdapter() {\n\t\t\t@Override\n\t\t\tpublic void keyPressed(KeyEvent e) {\n\n\t\t\t\tif (e.getKeyCode() == KeyEvent.VK_SPACE) {\n\t\t\t\t\tfinal TreePath selectionPath = tree.getSelectionPath();\n\t\t\t\t\tif (selectionPath == null) return;\n\t\t\t\t\tfinal Object lastPathComponent = selectionPath.getLastPathComponent();\n\t\t\t\t\tif (!(lastPathComponent instanceof BaseTreeNode<?>)) return;\n\n\t\t\t\t\tfinal Rectangle bounds = tree.getPathBounds(selectionPath);\n\t\t\t\t\tif (bounds == null) return;\n\n\t\t\t\t\tshowPopup((BaseTreeNode<?>) lastPathComponent, (int) bounds.getX(), (int) bounds.getY());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsetPreferredSize(new Dimension(~if(preferredWidth)~~preferredWidth~~else~400~endif~, ~if(preferredHeight)~~preferredHeight~~else~600~endif~));\n\t\tadd(new JScrollPane(tree), BorderLayout.CENTER);\n\n\t\t~constructorStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\n\t~baseTreeNode~\n\n\t~treeNodes:{it|~it~};separator=\"\\n\\n\"~\t\n\n\tprivate Action newAction(String name, Consumer<ActionEvent> actionEventConsumer) {\n\t\treturn new AbstractAction(name) {\n\t\t\t@Override\n\t\t\tpublic void actionPerformed(ActionEvent e) {\n\t\t\t\tactionEventConsumer.accept(e);\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate void showPopup(BaseTreeNode<?> lastPathComponent, int x, int y) {\n\t\tfinal List<Action> actions = lastPathComponent.getActions();\n\t\tif (actions.isEmpty()) return;\n\n\t\tfinal JPopupMenu pop = new JPopupMenu();\n\t\tpop.add(\"With \" + presentationModel.cut(lastPathComponent.getLabel()) + \" :\");\n\t\tfor (Action action : actions)\n\t\t\tpop.add(action);\n\n\t\tSwingUtilities.invokeLater(() -> pop.show(tree, x, y));\n\t}\n\n\tpublic <T> java.util.stream.Stream<T> getSelectedNodes(Class<T> type) {\n\t\tfinal TreePath[] selectionPaths = tree.getSelectionPaths();\n\t\tif (selectionPaths == null || selectionPaths.length == 0) return java.util.stream.Stream.empty();\n\t\treturn Arrays.stream(selectionPaths)\n\t\t\t\t.filter(treePath -> treePath.getLastPathComponent() != null)\n\t\t\t\t.filter(treePath -> treePath.getLastPathComponent().getClass().isAssignableFrom(type))\n\t\t\t\t.map(treePath -> (T) treePath.getLastPathComponent());\n\t}\n\n\t~methods:{it|~it~};separator=\"\\n\\n\"~\n} ",
    "parameters" : [ {
      "uuid" : "348d9666-cd87-4081-a94c-a6d719325794",
      "name" : "packageName",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "832a02d9-62c7-442f-947a-41e92eebe0e3",
      "name" : "imports",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "33901a65-a65f-4e83-940a-305e388da778",
      "name" : "name",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "f54c61c0-e129-4103-b552-ac6f243c6bcf",
      "name" : "fields",
      "type" : "KVLIST",
      "argumentType" : "Object",
      "keys" : [ {
        "uuid" : "3eab5f17-c24b-4c68-be57-f7f13579fc8f",
        "name" : "type",
        "argumentType" : "Object"
      }, {
        "uuid" : "f82cde2d-7e8f-46f6-b7ba-45bfef6d2995",
        "name" : "name",
        "argumentType" : "Object"
      } ]
    }, {
      "uuid" : "f524310c-a048-4e3b-af82-f8fc1371d6a6",
      "name" : "rootNodeExpression",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "539faf11-a97a-495c-acbf-b17b2f6f120f",
      "name" : "onSelectionStatements",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "ae08d437-3fb5-4d23-8740-96ce1bc07507",
      "name" : "preferredWidth",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "df3d94f5-b725-4a14-99f3-254396a28456",
      "name" : "preferredHeight",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "07397052-9797-4e19-84a2-43175cbbb861",
      "name" : "constructorStatements",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "f7711464-23c4-4958-a1ed-7391fa047792",
      "name" : "baseTreeNode",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "04fa15a8-33d0-4360-b026-a168d75bcd18",
      "name" : "treeNodes",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "019c976b-40a6-4366-b639-ff9b33652e74",
      "name" : "methods",
      "type" : "LIST",
      "argumentType" : "Object"
    } ],
    "children" : [ {
      "uuid" : "995d5c9a-e1a3-49a8-998d-81a4a4e9b13c",
      "name" : "BaseTreeNode",
      "text" : "public class BaseTreeNode<T> extends DefaultMutableTreeNode {\n\n\tprotected String label;\n\tprotected ImageIcon icon;\n\tprotected String tooltip;\n\n\tpublic BaseTreeNode(T model, String icon) {\n\t\tsetUserObject(model);\n\t\tthis.label = model.toString();\n\t\tthis.icon = presentationModel.loadIcon(icon);\n\t\tthis.tooltip = \"\";\n\t}\n\n\t@SuppressWarnings(\"unchecked\")\n\tpublic T getModel() {\n\t\treturn (T) getUserObject();\n\t}\n\n\tpublic String getLabel() {\n\t\treturn label;\n\t}\n\n\tpublic ImageIcon getIcon() {\n\t\treturn icon;\n\t}\n\n\tprotected java.util.List<Action> getActions() {\n\t\tjava.util.List<Action> actions = new ArrayList<>();\n\t\tactions.add(newAction(\"Expand\", actionEvent -> {\n\t\t\tSwingUtilities.invokeLater(() -> expandTreeNodesRecursive(getThisPath(), true));\n\t\t}));\n\t\tactions.add(newAction(\"Collapse\", actionEvent -> {\n\t\t\tSwingUtilities.invokeLater(() -> expandTreeNodesRecursive(getThisPath(), false));\n\t\t}));\n\t\treturn actions;\n\t}\n\n\t@Override\n\tpublic boolean equals(Object obj) {\n\t\tif (!(obj instanceof BaseTreeNode)) return false;\n\t\treturn getModel().equals(((BaseTreeNode<?>) obj).getModel());\n\t}\n\n\t@Override\n\tpublic int hashCode() {\n\t\treturn getModel().hashCode();\n\t}\n\n\t@SuppressWarnings(\"unchecked\")\n\tpublic <T> Optional<T> getParentNode(Class<T> type) {\n\t\tif (getClass().equals(type)) return (Optional<T>) Optional.of(this);\n\n\t\tfinal TreeNode parent = getParent();\n\t\tif (!(parent instanceof BaseTreeNode)) return Optional.empty();\n\n\t\treturn ((BaseTreeNode<?>) parent).getParentNode(type);\n\t}\n\n\tpublic String getTooltip() {\n\t\treturn tooltip;\n\t}\n\n\tpublic void nodeChanged() {\n\t\ttreeModel.nodeChanged(this);\n\t}\n\n\tprotected TreePath addChild(BaseTreeNode<?> child) {\n\t\tadd(child);\n\t\tfinal TreePath path = new TreePath(child.getPath());\n\t\ttreeModel.nodesWereInserted(BaseTreeNode.this, new int[]{getIndex(child)});\n\t\treturn path;\n\t}\n\n\tprotected void addAndSelectChild(BaseTreeNode<?> child) {\n\t\tfinal TreePath path = addChild(child);\n\t\ttree.scrollPathToVisible(path);\n\t\ttree.setSelectionPath(path);\n\t}\n\n\tprotected <T> java.util.stream.Stream<T> getChildren(Class<T> type) {\n\t\tfinal java.util.Set<T> set = new java.util.LinkedHashSet<>();\n\t\tfinal int childCount = getChildCount();\n\t\tfor (int i = 0; i < childCount; i++) {\n\t\t\tif (getChildAt(i).getClass().isAssignableFrom(type))\n\t\t\t\tset.add((T) getChildAt(i));\n\t\t}\n\n\t\treturn set.stream();\n\t}\n\n\tprotected TreePath find(java.util.function.Predicate<BaseTreeNode<?>~gt()~ predicate) {\n\t\tfinal int childCount = getChildCount();\n\t\tfor (int i = 0; i < childCount; i++) {\n\t\t\tfinal BaseTreeNode<?> childAt = (BaseTreeNode<?>) getChildAt(i);\n\t\t\tif (predicate.test(childAt))\n\t\t\t\treturn (childAt).getThisPath();\n\t\t\telse {\n\t\t\t\tfinal TreePath treePath = childAt.find(predicate);\n\t\t\t\tif (treePath != null) return treePath;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tprotected TreePath getThisPath() {\n\t\treturn new TreePath(getPath());\n\t}\n\n\tprotected void expandTreeNodesRecursive(TreePath parent, boolean expand) {\n\t\tTreeModel model = tree.getModel();\n\n\t\tObject node = parent.getLastPathComponent();\n\t\tint childCount = model.getChildCount(node);\n\t\tfor (int j = 0; j < childCount; j++) \n\t\t\texpandTreeNodesRecursive(parent.pathByAddingChild(model.getChild(node, j)), expand);\n\n\t\tif (expand) \n\t\t\ttree.expandPath(parent);\n\t\telse \n\t\t\ttree.collapsePath(parent);\n\t}\n} ",
      "parameters" : [ ]
    }, {
      "uuid" : "ecd9b597-6268-415b-9558-40ac8160f4a3",
      "name" : "TreeNode",
      "text" : "// ~name~\npublic class ~name~ extends BaseTreeNode<~modelType~> {\n~if(hasUuid)~\n\n\tprivate String uuid;\n~endif~\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\t~name~(~modelType~ model~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~~if(parameters)~, ~parameters:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper(model, ~if(icon)~~icon~~else~null~endif~);\n\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t\tthis.label = ~if(labelExpression)~~labelExpression~~else~model.toString();~endif~\n\t\tthis.tooltip = ~if(tooltipExpression)~~tooltipExpression~~else~\"\";~endif~\n\t\t~if(hasUuid)~this.uuid = model.getUuid();~endif~\n\n\t\t~constructorStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\n\t@Override\n\tpublic void nodeChanged() {\n\t\tthis.label = ~if(labelExpression)~~labelExpression~~else~getModel().toString();~endif~\n\t\tthis.tooltip = ~if(tooltipExpression)~~tooltipExpression~~else~\"\";~endif~\n\t\tsuper.nodeChanged();\n\t}\n\n\t@Override\n\tprotected List<Action> getActions() {\n\t\tfinal List<Action> actions = super.getActions();\n\t\t~getActionsStatements:{it|~it~};separator=\"\\n\"~\n\t\t~actions:{it|actions.add(~it~);};separator=\"\\n\"~\n\t\treturn actions;\n\t}\n\n\t~methods:{it|~it~};separator=\"\\n\\n\"~\n} ",
      "parameters" : [ {
        "uuid" : "ca9215d3-0be1-4d48-b46f-ab856ba1cdab",
        "name" : "name",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "2b516acd-1c47-4ed7-80e5-4be497c1328e",
        "name" : "modelType",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "51f3c617-c341-4f22-b8aa-5626f30e2d1c",
        "name" : "hasUuid",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "911980ea-5c02-4952-a2a5-464be92a9a99",
        "name" : "fields",
        "type" : "KVLIST",
        "argumentType" : "Object",
        "keys" : [ {
          "uuid" : "d14b359e-546d-4007-9fda-5202aefc5e1b",
          "name" : "type",
          "argumentType" : "Object"
        }, {
          "uuid" : "53a78064-00ab-44c9-aad2-a20f557b8a78",
          "name" : "name",
          "argumentType" : "Object"
        } ]
      }, {
        "uuid" : "94c28a8a-5d7c-43e4-9bc3-eeb01fb9d7d8",
        "name" : "parameters",
        "type" : "KVLIST",
        "argumentType" : "Object",
        "keys" : [ {
          "uuid" : "e2eb3f1d-ce8c-4a56-9e2f-4160bdcfef17",
          "name" : "type",
          "argumentType" : "Object"
        }, {
          "uuid" : "883a1a66-5a90-4ae5-afdc-ac2df12e166e",
          "name" : "name",
          "argumentType" : "Object"
        } ]
      }, {
        "uuid" : "7561af96-1b15-47ca-a808-588e5bebdabc",
        "name" : "icon",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "2eb89bf4-b00a-464a-ab77-5c2fdd1d7095",
        "name" : "labelExpression",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "b7c6e1c2-b875-4765-9422-aa12ffd99202",
        "name" : "tooltipExpression",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "36f95ca6-4eb8-4191-a869-da86548d44ad",
        "name" : "constructorStatements",
        "type" : "LIST",
        "argumentType" : "Object"
      }, {
        "uuid" : "f5220002-8c7d-4d46-9070-3a56921bc5d4",
        "name" : "getActionsStatements",
        "type" : "LIST",
        "argumentType" : "Object"
      }, {
        "uuid" : "706f675d-c5e2-4683-9c1e-682bd6391efa",
        "name" : "actions",
        "type" : "LIST",
        "argumentType" : "Object"
      }, {
        "uuid" : "6fcc71e8-ffb9-43e0-a1cf-347a0dfd5189",
        "name" : "methods",
        "type" : "LIST",
        "argumentType" : "Object"
      } ],
      "children" : [ {
        "uuid" : "a6c5217a-625b-477c-bb58-cc5fe0e708fb",
        "name" : "TreeNodeAction",
        "text" : "newAction(\"~title~\", actionEvent -> {\n\t~statements:{it|~it~};separator=\"\\n\"~\n}) ",
        "parameters" : [ {
          "uuid" : "12d3f5d1-df43-4cb5-a933-8a8bb9906f3d",
          "name" : "title",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "f1f82c21-b9ae-471e-8fa5-d53da216f21a",
          "name" : "statements",
          "type" : "LIST",
          "argumentType" : "Object"
        } ]
      } ]
    } ]
  }, {
    "uuid" : "ddde208a-2415-4367-a5f7-35e5e3ea0c9a",
    "name" : "Canvas",
    "text" : "package ~packageName~;\n\nimport nextgen.utils.SwingUtil;\nimport org.piccolo2d.PCamera;\nimport org.piccolo2d.PCanvas;\nimport org.piccolo2d.PLayer;\nimport org.piccolo2d.PNode;\nimport org.piccolo2d.event.*;\nimport org.piccolo2d.nodes.PPath;\nimport org.piccolo2d.nodes.PText;\nimport org.piccolo2d.util.PBounds;\n\nimport javax.swing.*;\nimport java.awt.*;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.KeyEvent;\nimport java.awt.geom.AffineTransform;\nimport java.awt.geom.Point2D;\nimport java.beans.PropertyChangeEvent;\nimport java.beans.PropertyChangeListener;\nimport java.util.*;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.function.Consumer;\nimport java.util.function.Predicate;\nimport java.util.stream.Stream;\n\nimport static java.awt.event.KeyEvent.*;\n\npublic class ~name~ extends PCanvas implements PInputEventListener {\n\n\tprivate final static org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(~name~.class);\n\n\tprivate final PLayer nodeLayer;\n\tprivate final PLayer relationLayer = new PLayer();\n\n\tfinal Map<String, BaseCanvasNode<?~gt()~> nodeMap = new ConcurrentHashMap<>();\n\tfinal Map<String, BaseCanvasRelation> relationMap = new ConcurrentHashMap<>();\n\n\tprivate final SelectEventsHandler selectEventHandler = new SelectEventsHandler();\n\tprivate final CanvasInputEventsHandler canvasInputEventsHandler = new CanvasInputEventsHandler();\n\tfinal CanvasZoomHandler canvasZoomHandler = new CanvasZoomHandler();\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\tpublic ~name~(Color background, Dimension preferredSize~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper();\n\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\n\t\tsetBackground(background);\n\t\tsetPreferredSize(preferredSize);\n\t\tnodeLayer = getLayer();\n\t\tgetCamera().addLayer(0, relationLayer);\n\n\t\tremoveInputEventListener(getZoomEventHandler());\n\t\taddInputEventListener(canvasZoomHandler);\n\t\taddInputEventListener(canvasInputEventsHandler);\n\t\t~constructorStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\n\tpublic ~name~ thisCanvas() {\n\t\treturn this;\n\t}\n\n\t~methods:{it|~it~};separator=\"\\n\\n\"~\n\n\t@Override\n\tpublic void processEvent(PInputEvent pInputEvent, int i) {\n\t\tcanvasInputEventsHandler.processEvent(pInputEvent, i);\n\t}\n\n\tpublic Point getCenterPosition() {\n\t\tfinal java.awt.geom.Point2D center2D = getCamera().getViewBounds().getCenter2D();\n\t\treturn new Point((int) center2D.getX(), (int) center2D.getY());\n\t}\n\n\tpublic Point getCurrentMousePosition() {\n\t\tfinal Point mousePosition = getMousePosition();\n\t\tif (mousePosition == null) return getCenterPosition();\n\t\tfinal java.awt.geom.Point2D localToView = getCamera().localToView(mousePosition);\n\t\treturn new Point((int) localToView.getX(), (int) localToView.getY());\n\t}\n\n\tpublic void centerNode(BaseCanvasNode<?> node) {\n\t\tSwingUtilities.invokeLater(() -> getCamera().animateViewToCenterBounds(node.getGlobalFullBounds(), false, 500));\n\t}\n\n\t@SuppressWarnings(\"unchecked\")\n\tpublic Stream<BaseCanvasNode<?~gt()~> getAllNodes() {\n\t\treturn nodeLayer.getAllNodes().stream().filter((Predicate<PNode>) node -> node instanceof BaseCanvasNode);\n\t}\n\n\tpublic Stream<BaseCanvasNode<?~gt()~> getSelectedNodes() {\n\t\treturn getAllNodes().filter(BaseCanvasNode::isSelected);\n\t}\n\n\tpublic Stream<BaseCanvasNode<?~gt()~> getUnselectedNodes() {\n\t\treturn getAllNodes().filter(stNode -> !stNode.isSelected());\n\t}\n\n\t@SuppressWarnings(\"unchecked\")\n\tpublic <R extends BaseCanvasRelation> Stream<R> getAllRelations() {\n\t\treturn relationLayer.getAllNodes().stream().filter((Predicate<PNode>) node -> node instanceof BaseCanvasRelation);\n\t}\n\n\tpublic <R extends BaseCanvasRelation> Stream<R> getSelectedRelations() {\n\t\treturn (Stream<R>) getAllRelations().filter(BaseCanvasRelation::isSelected);\n\t}\n\n\tpublic <N extends BaseCanvasNode<?~gt()~> N addNode(N node) {\n\t\treturn addNode(node.getUuid(), () -> node);\n\t}\n\n\tpublic <N extends BaseCanvasNode<?~gt()~> N addNode(String uuid, java.util.function.Supplier<N> supplier) {\n\n\t\tfinal N existing = getNode(uuid);\n\t\tif (existing != null) {\n\t\t\tlog.debug(\"N-\" + uuid + \" exists in canvas\");\n\t\t\texisting.refresh();\n\t\t\texisting.select();\n\t\t\treturn existing;\n\t\t}\n\t\tlog.debug(\"N-\" + uuid + \" added to canvas\");\n\n\t\tfinal N node= supplier.get();\n\t\tnode.select();\n\t\tnode.setOffset(getCenterPosition());\n\t\tnodeMap.put(node.getUuid(), node);\n\t\tnodeLayer.addChild(node);\n\n\t\t//nextgen.st.STAppEvents.postNodeAddedToCanvas(this, node);\n\n\t\tnode.addedToCanvas();\n\n\t\tgetAllNodes()\n\t\t\t\t.filter(stNode -> !stNode.getUuid().equals(node.getUuid()))\n\t\t\t\t.forEach(stNode -> stNode.newNodeAdded(node));\n\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tnode.refresh();\n\t\t\tcenterNode(node);\n\t\t});\n\n\t\treturn node;\n\t}\n\n\tpublic <N extends BaseCanvasNode<?~gt()~> N getNode(String uuid) {\n\t\treturn (N) nodeMap.get(uuid);\n\t}\n\n\t<N extends BaseCanvasNode<?~gt()~> N removeNode(String uuid) {\n\t\tfinal BaseCanvasNode remove = nodeMap.remove(uuid);\n\t\tfinal N old = (N) nodeLayer.removeChild(remove);\n\t\tlog.debug(\"\\tN-\"+ uuid + \" removed from canvas : \" + (old == null ? \"null\" : old.getUuid()));\n\t\treturn (N) remove;\n\t}\n\n\tpublic <R extends BaseCanvasRelation> R addRelation(String uuid, java.util.function.Supplier<R> supplier) {\n\n\t\tfinal R existing = getRelation(uuid);\n\t\tif (existing != null) {\n\t\t\tlog.debug(\"R-\"+ uuid + \" exists in canvas\");\n\t\t\treturn existing;\n\t\t}\n\t\tlog.debug(\"R-\"+ uuid + \" added to canvas\");\n\n\t\tfinal R relation = supplier.get();\n\t\trelationMap.put(relation.getUuid(), relation);\n\t\trelationLayer.addChild(relation);\n\t\treturn relation;\n\t}\n\n\t<R extends BaseCanvasRelation> R removeRelation(String uuid) {\n\t\tfinal BaseCanvasRelation remove = relationMap.remove(uuid);\n\t\tif (remove == null) return null;\n\n\t\tremove.close();\n\t\tfinal R old = (R) relationLayer.removeChild(remove);\n\t\tlog.debug(\"\\tR-\"+ uuid + \" removed from canvas : \" + (old == null ? \"null\" : old.getUuid()));\n\t\treturn (R) remove;\n\t}\n\n\tpublic <R extends BaseCanvasRelation> R getRelation(String uuid) {\n\t\treturn (R) relationMap.get(uuid);\n\t}\n\n\tprotected void onCanvasRightClick(JPopupMenu pop, PInputEvent event) {\n\n\t\t~rightClickStatements:{it|~it~};separator=\"\\n\"~\n\n\t\t~rightClickActions:{it|pop.add(new ~it.name~(event));};separator=\"\\n\"~\n\t\tpop.addSeparator();\n\t\tpop.add(new SelectAllNodes(event));\n\t\tpop.add(new UnselectAllNodes(event));\n\t\tpop.add(new RetainSelectedNodes(event));\n\t\tpop.add(new CloseSelectedNodes(event));\n\t\tpop.add(new CloseAllAction(event));\n\t\tpop.addSeparator();\n\t\tpop.add(new LayoutVerticallyAction(event, getCurrentMousePosition(), 20));\n\t}\n\n\tprotected void onCanvasLeftClick(PInputEvent event) {\n\t\tSwingUtilities.invokeLater(() -> getSelectedNodes().forEach(BaseCanvasNode::unselect));\n\t}\n\n\tprotected void onCanvasKeyPressed(PInputEvent event) {\n\t\tswitch (event.getKeyCode()) {\n~keyPressActions:{it|\n\t\t\tcase VK_~it.key~:\n\t\t\t\tnew ~it.name~(this, event).actionPerformed(null);\n\t\t\t\tbreak;\n};separator=\"\\n\"~\n\t\t\tcase VK_A:\n\t\t\t\tnew SelectAllNodes(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_ESCAPE:\n\t\t\t\tnew UnselectAllNodes(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_R:\n\t\t\t\tnew RetainSelectedNodes(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_C:\n\t\t\t\tif (event.isControlDown())\n\t\t\t\t\tnew CloseAllAction(event).actionPerformed(null);\n\t\t\t\telse\n\t\t\t\t\tnew CloseSelectedNodes(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_1:\n\t\t\t\tnew LayoutVerticallyAction(event, getCurrentMousePosition(), 20).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_SPACE:\n\t\t\t\tnew PopupAction(event).actionPerformed(null);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate final class CanvasInputEventsHandler extends PBasicInputEventHandler {\n\n\t\t@Override\n\t\tpublic void mouseEntered(PInputEvent event) {\n\t\t\tif (!this.equals(event.getInputManager().getKeyboardFocus())) {\n\t\t\t\tevent.getInputManager().setKeyboardFocus(this);\n\t\t\t\trequestFocusInWindow();\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseExited(PInputEvent event) {\n\t\t\tevent.getInputManager().setKeyboardFocus(null);\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseClicked(PInputEvent event) {\n\t\t\tremoveInputEventListener(selectEventHandler);\n\t\t\tif (!this.equals(event.getInputManager().getKeyboardFocus())) event.getInputManager().setKeyboardFocus(this);\n\t\t\tif (event.isRightMouseButton()) {\n\t\t\t\tSwingUtilities.invokeLater(() -> {\n\t\t\t\t\tfinal JPopupMenu pop = new JPopupMenu();\n\t\t\t\t\tsetCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));\n\t\t\t\t\tonCanvasRightClick(pop, event);\n\t\t\t\t\tsetCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));\n\t\t\t\t\tpop.show(thisCanvas(), (int) event.getCanvasPosition().getX(), (int) event.getCanvasPosition().getY());\n\t\t\t\t});\n\t\t\t} else if (event.isLeftMouseButton()) SwingUtilities.invokeLater(() -> onCanvasLeftClick(event));\n\t\t}\n\n\t\t@Override\n\t\tpublic void keyPressed(PInputEvent event) {\n\t\t\tif (event.isControlDown()) {\n\t\t\t\tremoveInputEventListener(selectEventHandler);\n\t\t\t\taddInputEventListener(selectEventHandler.init(event));\n\t\t\t} else {\n\t\t\t\tonCanvasKeyPressed(event);\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void keyReleased(PInputEvent event) {\n\t\t\tif (event.getKeyCode() == KeyEvent.VK_CONTROL) removeInputEventListener(selectEventHandler.end());\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseMoved(PInputEvent event) {\n\t\t\tif (!event.isControlDown()) removeInputEventListener(selectEventHandler.end());\n\t\t\tinvalidate();\n\t\t\trepaint();\n\t\t}\n\t}  \n\n\tprivate final class SelectEventsHandler extends PBasicInputEventHandler {\n\n\t\tprivate PPath selectionRectangle;\n\t\tprivate boolean isDragging = true;\n\t\tprivate double startX;\n\t\tprivate double startY;\n\n\t\tPInputEventListener init(PInputEvent event) {\n\t\t\tisDragging = event.isControlDown();\n\t\t\tif (selectionRectangle != null) nodeLayer.removeChild(selectionRectangle);\n\t\t\tstartX = getCamera().localToView(event.getCanvasPosition()).getX();\n\t\t\tstartY = getCamera().localToView(event.getCanvasPosition()).getY();\n\t\t\tselectionRectangle = PPath.createRectangle(startX, startY, 1, 1);\n\t\t\tselectionRectangle.setTransparency(.5f);\n\t\t\tnodeLayer.addChild(selectionRectangle);\n\t\t\treturn this;\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseMoved(PInputEvent event) {\n\t\t\tif (isDragging) {\n\t\t\t\tfinal double eventX = getCamera().localToView(event.getCanvasPosition()).getX();\n\t\t\t\tfinal double eventY = getCamera().localToView(event.getCanvasPosition()).getY();\n\t\t\t\tfinal boolean left = eventX < startX;\n\t\t\t\tselectionRectangle.setX(left ? eventX : startX);\n\t\t\t\tselectionRectangle.setWidth(left ? (startX - eventX) : (eventX - startX));\n\t\t\t\tfinal boolean top = eventY < startY;\n\t\t\t\tselectionRectangle.setY(top ? eventY : startY);\n\t\t\t\tselectionRectangle.setHeight(top ? (startY - eventY) : (eventY - startY));\n\t\t\t\tfinal PBounds fullBounds = selectionRectangle.getFullBounds();\n\t\t\t\tSwingUtilities.invokeLater(() -> getAllNodes()\n\t\t\t\t\t.filter(node -> !node.isSelected())\n\t\t\t\t\t.forEach(node -> {\n\t\t\t\t\t\tif (fullBounds.contains(node.getFullBounds())) node.select();\n\t\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\tpublic PInputEventListener end() {\n\t\t\tisDragging = false;\n\t\t\tif (selectionRectangle != null) nodeLayer.removeChild(selectionRectangle);\n\t\t\treturn this;\n\t\t}\n\t}  \n\n\tprivate static class CanvasZoomHandler extends PBasicInputEventHandler {\n\n\t\tfinal private static double maxZoomScale = 2.0d;\n\t\tfinal private static double minZomScale = 0.025d;\n\t\tprivate double scaleFactor = 0.05d;\n\n\t\tCanvasZoomHandler() {\n\t\t\tsuper();\n\t\t\tfinal PInputEventFilter eventFilter = new PInputEventFilter();\n\t\t\teventFilter.rejectAllEventTypes();\n\t\t\teventFilter.setAcceptsMouseWheelRotated(true);\n\t\t\tsetEventFilter(eventFilter);\n\t\t}\n\n\t\tpublic void mouseWheelRotated(final PInputEvent event) {\n\t\t\tfinal PCamera camera = event.getCamera();\n\t\t\tif ((camera.getViewScale() < minZomScale && event.getWheelRotation() < 0) || (camera.getViewScale() > maxZoomScale && event.getWheelRotation() > 0)) return;\n\t\t\tfinal double scale = 1.0d + event.getWheelRotation() * scaleFactor;\n\t\t\tfinal java.awt.geom.Point2D viewAboutPoint = event.getPosition();\n\t\t\tcamera.scaleViewAboutPoint(scale, viewAboutPoint.getX(), viewAboutPoint.getY());\n\t\t}\n\t}  \n\n\tabstract class CanvasAction extends AbstractAction {\n\n\t\tfinal PInputEvent event;\n\n\t\tCanvasAction(String name, PInputEvent event) {\n\t\t\tsuper(name);\n\t\t\tthis.event = event;\n\t\t}\n\n\t\t@Override\n\t\tpublic void actionPerformed(ActionEvent e) {\n\t\t\tactionPerformed(event, e);\n\t\t}\n\n\t\tabstract void actionPerformed(PInputEvent event, ActionEvent e);\n\t}\n\n\t~BaseCanvasNode()~\n\n\t~BaseCanvasRelation()~\n\n\t~actions:{it|~it~};separator=\"\\n\\n\"~\n\n\t~canvasNodes:{it|~it~};separator=\"\\n\\n\"~\n\n\t~canvasRelations:{it|~it~};separator=\"\\n\\n\"~\n} ",
    "children" : [ {
      "uuid" : "e1ea54f2-0ecd-41cc-9904-1a06be717f12",
      "name" : "BaseCanvasNode",
      "text" : "protected class BaseCanvasNode<T> extends PNode {\n\n\tprotected PText child;\n\tprotected final Set<String> outgoing = new LinkedHashSet<>();\n\tprotected final Set<String> incoming = new LinkedHashSet<>();\n\n\tprivate PPath rectangle;\n\n\tpublic BaseCanvasNode(T model, String uuid, String label) {\n\t\tthis.addAttribute(\"_defaultColor\", UIManager.getColor(\"TextField.foreground\"));\n\t\tthis.addAttribute(\"_selectedColor\", Color.decode(\"#2b8cbe\"));\n\t\tthis.addAttribute(\"_highlightedColor\", Color.decode(\"#e66101\"));\n\t\tthis.addAttribute(\"_rectangleColor\", new Color(253, 141, 60, 50));\n\t\tthis.addAttribute(\"_model\", model);\n\t\tthis.addAttribute(\"_uuid\", uuid);\n\t\tthis.addAttribute(\"_text\", label);\n\t\tthis.child = new PText(getText() == null ? getUuid() : getText());\n\t\tthis.addChild(this.child);\n\n\t\tfinal NodeInputEventHandler nodeInputEventHandler = new NodeInputEventHandler();\n\t\tnodeInputEventHandler.getEventFilter().setMarksAcceptedEventsAsHandled(true);\n\t\taddInputEventListener(nodeInputEventHandler);\n\t\taddInputEventListener(canvasZoomHandler);\n\n\t\t//org.greenrobot.eventbus.EventBus.getDefault().register(this);\n\t}\n\n\tprotected BaseCanvasNode<T> thisNode() {\n\t\treturn this;\n\t}\n\t\n\t@SuppressWarnings(\"unchecked\")\n\tpublic T getModel() {\n\t\treturn (T) getAttribute(\"_model\");\n\t}\n\n\tpublic void addedToCanvas() {\n\n\t}\n\n\tpublic void newNodeAdded(BaseCanvasNode<?> node) {\n\n\t}\n\n\t@Override\n\tpublic double getHeight() {\n\t\treturn child.getHeight();\n\t}\n\n\t@Override\n\tpublic double getWidth() {\n\t\treturn child.getWidth();\n\t}\n\n\t@Override\n\tpublic String toString() {\n\t\treturn getUuid() + \" \" + getText();\n\t}\n\n\t@Override\n\tpublic boolean equals(Object o) {\n\t\tif (this == o) return true;\n\t\tif (o == null || getClass() != o.getClass()) return false;\n\n\t\tBaseCanvasNode<?> other = (BaseCanvasNode<?>) o;\n\n\t\treturn getUuid().equals(other.getUuid());\n\t}\n\n\t@Override\n\tpublic int hashCode() {\n\t\treturn getUuid().hashCode();\n\t}\n\n\tpublic String getUuid() {\n\t\treturn (String) getAttribute(\"_uuid\");\n\t}\n\n\tpublic String getText() {\n\t\treturn (String) getAttribute(\"_text\");\n\t}\n\n\tpublic void setText(String text) {\n\t\taddAttribute(\"_text\", text == null || text.trim().length() == 0 ? getUuid().toString() : text);\n\t\tchild.setText(getText());\n\t\trefresh();\n\t}\n\n\tpublic void refresh() {\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tsetPaintInvalid(true);\n\t\t\trepaint();\n\t\t});\n\t}\n\n\tpublic void addOutgoingRelation(String relation) {\n\t\tthis.outgoing.add(relation);\n\t}\n\n\tpublic void addIncomingRelation(String relation) {\n\t\tthis.incoming.add(relation);\n\t}\n\n\tpublic java.util.stream.Stream<String> outgoing() {\n\t\treturn this.outgoing.stream();\n\t}\n\n\tpublic java.util.stream.Stream<String> incoming() {\n\t\treturn this.incoming.stream();\n\t}\n\n\tpublic void unselect() {\n\t\taddAttribute(\"_selected\", Boolean.FALSE);\n\t\tSwingUtilities.invokeLater(() -> child.setTextPaint((Color) getAttribute(\"_defaultColor\")));\n\t}\n\n\tpublic void select() {\n\t\taddAttribute(\"_selected\", Boolean.TRUE);\n\t\tSwingUtilities.invokeLater(() -> child.setTextPaint((Color) getAttribute(\"_selectedColor\")));\n\t}\n\n\tpublic boolean isSelected() {\n\t\treturn getBooleanAttribute(\"_selected\", false);\n\t}\n\n\tpublic void unhighlight() {\n\t\taddAttribute(\"_highlight\", Boolean.FALSE);\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tchild.setTextPaint(isSelected() ? (Color) getAttribute(\"_selectedColor\") : (Color) getAttribute(\"_defaultColor\"));\n\t\t\tif (rectangle != null) BaseCanvasNode.this.removeChild(rectangle);\t\n\t\t});\n\t}\n\n\tpublic void highlight() {\n\t\taddAttribute(\"_highlight\", Boolean.TRUE);\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tfinal PBounds fullBounds = child.getFullBoundsReference();\n\t\t\trectangle = PPath.createRectangle(fullBounds.getX(), fullBounds.getY(), fullBounds.getWidth(), fullBounds.getHeight());\n\t\t\trectangle.setPaint((Color) getAttribute(\"_rectangleColor\"));\n\t\t\trectangle.setStroke(new BasicStroke());\n\t\t\tBaseCanvasNode.this.addChild(rectangle);\n\n\t\t\tchild.setTextPaint((Color) getAttribute(\"_highlightedColor\"));\n\t\t});\n\t}\n\n\tpublic void close() {\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tfor (String uuid : incoming) removeRelation(uuid);\n\t\t\tfor (String uuid : outgoing) removeRelation(uuid);\n\t\t\torg.greenrobot.eventbus.EventBus.getDefault().unregister(BaseCanvasNode.this);\n\t\t\tremoveNode(getUuid());\t\t\t\n\t\t});\n\t}\n\n\tprotected void onNodeKeyPressed(PInputEvent event) {\n\t\tswitch (event.getKeyCode()) {\n\t\t\tcase VK_1:\n\t\t\t\tnew LayoutTreeAction(BaseCanvasNode.this, event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_C:\n\t\t\t\tnew CloseNode(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_R:\n\t\t\t\tnew RetainNode(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_F:\n\t\t\t\tnew PopupAction(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t\tcase VK_B:\n\t\t\t\tnew DebugAction(event).actionPerformed(null);\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tprotected void onNodeLeftClick(PInputEvent event) {\n\t\tif (isSelected()) unselect();\n\t\telse select();\n\t}\n\n\tprotected void onNodeRightClick(PInputEvent event, JPopupMenu pop) {\n\n\t\tpop.add(new LayoutTreeAction(BaseCanvasNode.this, event));\n\t\tpop.add(new RetainNode(event));\n\t\tpop.add(new CloseNode(event));\n\t\tpop.add(new DebugAction(event));\n\n\t}\n\n\tprivate final class NodeInputEventHandler extends PDragSequenceEventHandler {\n\n\t\t@Override\n\t\tfinal protected void startDrag(PInputEvent event) {\n\t\t\tsuper.startDrag(event);\n\t\t}\n\n\t\t@Override\n\t\tfinal protected void drag(PInputEvent event) {\n\t\t\tsuper.drag(event);\n\t\t\ttranslate(event.getDelta().width, event.getDelta().height);\n\t\t}\n\n\t\t@Override\n\t\tfinal protected void endDrag(PInputEvent event) {\n\t\t\tsuper.endDrag(event);\n\t\t}\n\n\t\t@Override\n\t\tfinal protected boolean shouldStartDragInteraction(PInputEvent event) {\n\t\t\treturn super.shouldStartDragInteraction(event);\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseEntered(PInputEvent event) {\n\t\t\tif (!event.isControlDown()) \n\t\t\t\tevent.getInputManager().setKeyboardFocus(this);\n\t\t\thighlight();\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseExited(PInputEvent event) {\n\t\t\tunhighlight();\n\t\t\tif (!event.isControlDown()) \n\t\t\t\tevent.getInputManager().setKeyboardFocus(thisCanvas());\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseClicked(PInputEvent event) {\n\t\t\tif (event.isRightMouseButton()) {\n\t\t\t\tfinal JPopupMenu pop = new JPopupMenu();\n\t\t\t\tthisCanvas().setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));\n\t\t\t\tonNodeRightClick(event, pop);\n\t\t\t\tthisCanvas().setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));\n\t\t\t\tpop.show(thisCanvas(), (int) event.getCanvasPosition().getX(), (int) event.getCanvasPosition().getY());\n\t\t\t} else if (event.isLeftMouseButton()) {\n\t\t\t\tSwingUtilities.invokeLater(() -> onNodeLeftClick(event));\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void keyPressed(PInputEvent event) {\n\t\t\tonNodeKeyPressed(event);\n\t\t}\n\t}  \t\n\n\tabstract class NodeAction extends AbstractAction {\n\n\t\tfinal PInputEvent event;\n\n\t\tNodeAction(String name, PInputEvent event) {\n\t\t\tsuper(name);\n\t\t\tthis.event = event;\n\t\t}\n\n\t\tprotected void setName(String name) {\n\t\t\tputValue(Action.NAME, name);\n\t\t}\n\n\t\t@Override\n\t\tpublic void actionPerformed(ActionEvent e) {\n\t\t\tactionPerformed(event, e);\n\t\t}\n\n\t\tabstract void actionPerformed(PInputEvent event, ActionEvent e);\n\n\t}\n\n\tprotected final class LayoutTreeAction extends NodeAction {\n\n\t\tprivate final Map<String, BaseCanvasNode<?>~gt()~ parentsMap = new LinkedHashMap<>();\n\t\tprivate final Map<String, java.util.List<BaseCanvasNode<?>~gt()~~gt()~ childrensMap = new LinkedHashMap<>();\n\t\tprivate final org.abego.treelayout.util.DefaultConfiguration<BaseCanvasNode<?~gt()~> configuration;\n\n\t\tprotected LayoutTreeAction(BaseCanvasNode<?> root, PInputEvent event) {\n\t\t\tthis(root, event, org.abego.treelayout.Configuration.Location.Left, org.abego.treelayout.Configuration.AlignmentInLevel.TowardsRoot);\n\t\t}\n\n\t\tprotected LayoutTreeAction(BaseCanvasNode<?> root, PInputEvent event, org.abego.treelayout.Configuration.Location location, org.abego.treelayout.Configuration.AlignmentInLevel alignmentInLevel) {\n\t\t\tsuper(\"Layout Tree\", event);\n\t\t\tthis.configuration = new org.abego.treelayout.util.DefaultConfiguration<>(100, 15, location, alignmentInLevel);\n\t\t}\n\n\t\t@Override\n\t\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\n\t\t\tnew Thread(() -> {\n\n\t\t\t\tfindChildren(BaseCanvasNode.this);\n\n\t\t\t\tfinal org.abego.treelayout.TreeForTreeLayout<BaseCanvasNode<?>~gt()~ tree = new org.abego.treelayout.util.AbstractTreeForTreeLayout<BaseCanvasNode<?>~gt()~(BaseCanvasNode.this) {\n\t\t\t\t\t@Override\n\t\t\t\t\tpublic BaseCanvasNode<?> getParent(BaseCanvasNode<?> node) {\n\t\t\t\t\t\treturn parentsMap.get(node.getUuid());\n\t\t\t\t\t}\n\n\t\t\t\t\t@Override\n\t\t\t\t\tpublic java.util.List<BaseCanvasNode<?>~gt()~ getChildrenList(BaseCanvasNode<?> node) {\n\t\t\t\t\t\tif (node == null) return Collections.emptyList();\n\t\t\t\t\t\treturn childrensMap.get(node.getUuid());\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfinal org.abego.treelayout.NodeExtentProvider<BaseCanvasNode<?>~gt()~ nodeExtendProvider = new org.abego.treelayout.NodeExtentProvider<BaseCanvasNode<?>~gt()~() {\n\t\t\t\t\t@Override\n\t\t\t\t\tpublic double getWidth(BaseCanvasNode<?> node) {\n\t\t\t\t\t\treturn node.getFullBounds().getWidth();\n\t\t\t\t\t}\n\n\t\t\t\t\t@Override\n\t\t\t\t\tpublic double getHeight(BaseCanvasNode<?> node) {\n\t\t\t\t\t\treturn node.getFullBounds().getHeight();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfinal org.abego.treelayout.TreeLayout<BaseCanvasNode<?>~gt()~ layout = new org.abego.treelayout.TreeLayout<>(tree, nodeExtendProvider, configuration);\n\n\t\t\t\t// apply coordinate transforms in relation to root-node\n\t\t\t\tfinal java.awt.geom.Rectangle2D.Double rootBounds = layout.getNodeBounds().get(BaseCanvasNode.this);\n\t\t\t\tfinal double deltaX = getFullBounds().getX() - rootBounds.getX();\n\t\t\t\tfinal double deltaY = getFullBounds().getY() - rootBounds.getY();\n\n\t\t\t\tSwingUtilities.invokeLater(() -> {\n\t\t\t\t\tfor (Map.Entry<BaseCanvasNode<?>, java.awt.geom.Rectangle2D.Double> nodeBound : layout.getNodeBounds().entrySet()) {\n\t\t\t\t\t\tif (nodeBound.getKey().equals(BaseCanvasNode.this)) continue;\t// root-node is transformation-root\n\t\t\t\t\t\tnodeBound.getKey().setOffset(nodeBound.getValue().getX() + deltaX, nodeBound.getValue().getY() + deltaY);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}).start();\n\t\t}\n\n\t\tprivate void findChildren(BaseCanvasNode<?> node) {\n\n\t\t\tif (childrensMap.containsKey(node.getUuid())) return;\n\n\t\t\tchildrensMap.put(node.getUuid(), new ArrayList<>());\n\n\t\t\tnode.outgoing()\n\t\t\t\t\t.filter(thisCanvas().relationMap::containsKey)\n\t\t\t\t\t.map(uuid -> thisCanvas().relationMap.get(uuid).getDst())\n\t\t\t\t\t.filter(abstractNode -> !childrensMap.containsKey(abstractNode.getUuid()))\n\t\t\t\t\t.forEach(abstractNode -> {\n\t\t\t\t\t\t\tchildrensMap.get(node.getUuid()).add(abstractNode);\n\t\t\t\t\t\t\tparentsMap.put(abstractNode.getUuid(), node);\n\t\t\t\t\t});\n\n\t\t\tchildrensMap.get(node.getUuid()).forEach(this::findChildren);\n\t\t}\n\t}\n\n\tprivate final class RetainNode extends NodeAction {\n\n\t\tRetainNode(PInputEvent event) {\n\t\t\tsuper(\"Retain\", event);\n\t\t}\n\n\t\t@Override\n\t\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\t\t\tjavax.swing.SwingUtilities.invokeLater(() -> {\n\t\t\t\tthisCanvas().getAllRelations().forEach(relation -> thisCanvas().removeRelation(relation.getUuid()));\n\t\t\t\tthisCanvas().relationLayer.removeAllChildren();\n\t\t\t\tthisCanvas().getAllNodes().filter(canvasNode -> !canvasNode.getUuid().equals(getUuid())).forEach(BaseCanvasNode::close);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate final class CloseNode extends NodeAction {\n\n\t\tCloseNode(PInputEvent event) {\n\t\t\tsuper(\"Close\", event);\n\t\t}\n\n\t\t@Override\n\t\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\t\t\tjavax.swing.SwingUtilities.invokeLater(() -> thisNode().close());\n\t\t}\n\t}\n\n\tprivate final class PopupAction extends NodeAction {\n\n\t\tPopupAction(PInputEvent event) {\n\t\t\tsuper(\"Popup\", event);\n\t\t}\n\n\t\t@Override\n\t\tvoid actionPerformed( PInputEvent event, ActionEvent e) {\n\t\t\tjavax.swing.SwingUtilities.invokeLater(() -> {\n\t\t\t\tfinal javax.swing.JPopupMenu pop = new javax.swing.JPopupMenu();\n\t\t\t\tsetCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.WAIT_CURSOR));\n\t\t\t\tonNodeRightClick(event, pop);\n\t\t\t\tsetCursor(java.awt.Cursor.getPredefinedCursor(java.awt.Cursor.DEFAULT_CURSOR));\n\t\t\t\tpop.show(thisCanvas(), (int) event.getCanvasPosition().getX(), (int) event.getCanvasPosition().getY());\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate final class DebugAction extends NodeAction {\n\n\t\tDebugAction(PInputEvent event) {\n\t\t\tsuper(\"Debug\", event);\n\t\t}\n\n\t\t@Override\n\t\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\t\t\tjavax.swing.SwingUtilities.invokeLater(() -> {\n\t\t\t\tfinal PBounds fullBounds = getFullBoundsReference();\n\t\t\t\tlog.info(getUuid() + \" : \" + getText());\n\t\t\t\tlog.info(fullBounds.getX() + \",\" + fullBounds.getY() + \", [\" + fullBounds.getWidth() + \",\" + fullBounds.getHeight() + \"]\");\n\t\t\t\toutgoing().forEach(uuid -> log.info(\" -> \" + uuid));\n\t\t\t\tincoming().forEach(uuid -> log.info(\" <- \" + uuid));\n\t\t\t});\n\t\t}\n\t}\n} ",
      "parameters" : [ ],
      "children" : [ {
        "uuid" : "e1bdb5a6-e400-4975-8082-138672753225",
        "name" : "CanvasNode",
        "text" : "final class ~name~ extends BaseCanvasNode<~modelType~> {\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\tpublic ~name~(~modelType~ model~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper(model, ~if(uuidExpression)~~uuidExpression~~else~uuid~endif~, ~if(labelExpression)~~labelExpression~~else~label~endif~);\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n~if(addedToCanvasStatements)~\n\t\n\t@Override\n\tpublic void addedToCanvas() {\n\t\t~addedToCanvasStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\t\n~endif~\n~if(newNodeAddedStatements)~\n\t\n\t@Override\n\tpublic void newNodeAdded(BaseCanvasNode<?> node) {\n\t\t~newNodeAddedStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\t\n~endif~\n\t@Override\n\tprotected void onNodeRightClick(PInputEvent event, JPopupMenu pop) {\n\t\t~rightClickStatements:{it|~it~};separator=\"\\n\"~\n\t\t~rightClickActions:{it|pop.add(new ~it.name~(event));};separator=\"\\n\"~\n\t\tsuper.onNodeRightClick(event, pop);\n\t}\n~if(leftClickStatements)~\n\n\t@Override\n\tprotected void onNodeLeftClick(PInputEvent event) {\n\t\tsuper.onNodeLeftClick(event);\n\t\t~leftClickStatements:{it|~it~};separator=\"\\n\"~\n\t}\n\t\n~endif~\n~if(keyPressActions)~\n\n\t@Override\n\tprotected void onNodeKeyPressed(PInputEvent event) {\n\t\tswitch (event.getKeyCode()) {\n~keyPressActions:{it|\n\t\t\tcase VK_~it.key~:\n\t\t\t\tnew ~it.name~(event).actionPerformed(null);\n\t\t\t\tbreak;\n};separator=\"\\n\"~\n\t\t}\n\t\tsuper.onNodeKeyPressed(event);\n\t}\n\t\n~endif~\n\t\n\t~actions:{it|~it~};separator=\"\\n\\n\"~\n\n\t~methods:{it|~it~};separator=\"\\n\\n\"~\n}\n\nprivate void add~name~(~modelType~ model~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\taddNode(~if(uuidExpression)~~uuidExpression~~else~uuid~endif~, new~name~(model~if(uuidExpression)~~else~, uuid~endif~~if(labelExpression)~~else~, label~endif~~if(fields)~, ~fields:{it|~it.name~};separator=\", \"~~endif~));\n}\n\npublic java.util.function.Supplier<STModelCanvas.~name~> new~name~(~modelType~ model~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\treturn () -> new STModelCanvas.~name~(model~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.name~};separator=\", \"~~endif~);\n}\n\npublic Stream<~name~> getAll~name;format=\"capitalize\"~() {\n\treturn getAllNodes()\n\t\t\t\t.filter(baseCanvasNode -> baseCanvasNode instanceof ~name~)\n\t\t\t\t.map(baseCanvasNode -> (~name~) baseCanvasNode);\n}\n\npublic void forEach~name;format=\"capitalize\"~(java.util.function.Consumer<~name~> consumer) {\n\tgetAllNodes()\n\t\t\t.filter(baseCanvasNode -> baseCanvasNode instanceof ~name~)\n\t\t\t.map(baseCanvasNode -> (~name~) baseCanvasNode)\n\t\t\t.forEach(consumer);\n}\n\npublic Optional<~name~> isInstanceOf~name~(BaseCanvasNode<?> canvasNode) {\n\treturn Optional.ofNullable((canvasNode instanceof ~name~) ? (~name~) canvasNode : null);\n} ",
        "parameters" : [ {
          "uuid" : "38f5c0c1-de25-46c6-a69a-88f3fb1d2315",
          "name" : "name",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "3c99f2b6-2b36-4e74-99c8-bfea0cc6fda5",
          "name" : "modelType",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "640d3e1d-4b6e-4c05-a15c-90c7eed1e01e",
          "name" : "fields",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "4781e22d-027c-481a-ad34-b3593f3ce2b6",
            "name" : "type",
            "argumentType" : "Object"
          }, {
            "uuid" : "a43f0d9d-ab57-420b-be23-c4c8e6bf9f24",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "29249231-ea5e-4528-9992-9ec4089fcfdc",
          "name" : "uuidExpression",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "9a1c5b6c-30ad-474f-9d96-c81d868660bf",
          "name" : "labelExpression",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "8e0daa13-5d03-458c-bb7c-3ad1bff49c31",
          "name" : "addedToCanvasStatements",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "1e7d5082-15f0-4b8c-96e5-8e149d0b4b62",
          "name" : "newNodeAddedStatements",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "44c0b439-ed0a-4032-8488-6cc59d782f60",
          "name" : "rightClickStatements",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "5d86bfec-abac-4921-b03e-6a4808ab570a",
          "name" : "rightClickActions",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "4cec3db2-04e5-4942-8dd5-45723a095d8a",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "f41b877c-6535-411a-a37c-b0e68dc61d6c",
          "name" : "leftClickStatements",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "c4ce5ef7-fdcb-4bd5-a956-c6334dd8e609",
          "name" : "keyPressActions",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "505592d6-5248-45ca-b269-46e1d755e82c",
            "name" : "key",
            "argumentType" : "Object"
          }, {
            "uuid" : "5e94cbbf-7948-4c50-af8e-19bcc42f40ca",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "dd6c238b-22d5-4db2-9ed4-e36f5871c9db",
          "name" : "actions",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "9ff6dac3-4713-42d1-aab5-749b263b1763",
          "name" : "methods",
          "type" : "LIST",
          "argumentType" : "Object"
        } ],
        "children" : [ {
          "uuid" : "52c2813f-bfb6-4c98-838b-66d558bb0e76",
          "name" : "CanvasNodeAction",
          "text" : "final class ~name~ extends NodeAction {\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\t~name~(PInputEvent event~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper(~if(titleExpression)~~titleExpression~~else~\"~title~\"~endif~, event);\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n\n\t@Override\n\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n~if(transactional)~\n\t\tpresentationModel.doLaterInTransaction(transaction -> {\n\t\t\t~statements:{it|~it~};separator=\"\\n\"~\n\t\t});\n~else~\n\t\t~statements:{it|~it~};separator=\"\\n\"~\n~endif~\n\t}\n} ",
          "parameters" : [ {
            "uuid" : "61eb0282-c019-447c-acda-67e9d84a66c9",
            "name" : "name",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "8ddd81cd-6717-453f-a1cf-7b5c08c8f2a5",
            "name" : "fields",
            "type" : "KVLIST",
            "argumentType" : "Object",
            "keys" : [ {
              "uuid" : "6000e9cb-801d-466f-80bb-e672bf9751a4",
              "name" : "type",
              "argumentType" : "Object"
            }, {
              "uuid" : "adfc6b8e-b7bc-48b4-9a60-10fc7f861013",
              "name" : "name",
              "argumentType" : "Object"
            } ]
          }, {
            "uuid" : "98fa7150-1966-43fd-a2cb-fa2d60b11ebd",
            "name" : "titleExpression",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "9323ee26-1eed-4fbe-bee3-731787174087",
            "name" : "title",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "1653bf7e-458c-4432-b2c5-fe6dc076a0e0",
            "name" : "transactional",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "c2708b39-71e5-4703-80e2-672158ca3ff0",
            "name" : "statements",
            "type" : "LIST",
            "argumentType" : "Object"
          } ]
        } ]
      } ]
    }, {
      "uuid" : "2aa604b1-91a9-4cc7-9bd9-34898b0c2dc7",
      "name" : "BaseCanvasRelation",
      "text" : "protected class BaseCanvasRelation extends PPath.Double implements Comparator<BaseCanvasRelation> {\n\n\tfinal protected PText child;\n\tprivate final PNodeChangeListener nodeChangeListener = new PNodeChangeListener();\n\n\tpublic BaseCanvasRelation(BaseCanvasNode<?> src, BaseCanvasNode<?> dst, String uuid, String type) {\n\t\tthis.addAttribute(\"_defaultColor\", Color.decode(\"#bababa\"));\n\t\tthis.addAttribute(\"_selectedColor\", Color.decode(\"#b2182b\"));\n\t\tthis.addAttribute(\"_highlightedColor\", Color.decode(\"#f4a582\"));\n\t\tthis.addAttribute(\"_uuid\", uuid);\n\t\tthis.addAttribute(\"_type\", type);\n\t\tthis.addAttribute(\"_src\", src);\n\t\tthis.addAttribute(\"_dst\", dst);\n\n\t\tsrc.addOutgoingRelation(getUuid());\n\t\tdst.addIncomingRelation(getUuid());\n\n\t\tthis.child = new PText(type);\n\n\t\tsetPaint((Color) getAttribute(\"_defaultColor\"));\n\t\tchild.setTextPaint((Color) getAttribute(\"_defaultColor\"));\n\n\t\tfinal RelationInputEventHandler relationInputEventHandler = new RelationInputEventHandler();\n\t\trelationInputEventHandler.getEventFilter().setMarksAcceptedEventsAsHandled(true);\n\t\taddInputEventListener(relationInputEventHandler);\n\t\taddInputEventListener(canvasZoomHandler);\n\n\t\tsrc.addPropertyChangeListener(nodeChangeListener);\n\t\tdst.addPropertyChangeListener(nodeChangeListener);\n\t\taddChild(this.child);\n\n\t\tSwingUtilities.invokeLater(() -> updatePath((getSrc()), getDst()));\n\t}\n\n\t@Override\n\tpublic String toString() {\n\t\treturn getUuid() + \" \" + getSrc() + \" -> \" + getType() + \" -> \" + getDst();\n\t}\n\n\tpublic void close() {\n\t\tSwingUtilities.invokeLater(() -> {\n\t\t\tlog.info(\"R-\" + getUuid() + \" closed\");\n\t\t\tgetSrc().outgoing.remove(getUuid());\n\t\t\tgetDst().incoming.remove(getUuid());\n\t\t\tgetSrc().removePropertyChangeListener(nodeChangeListener);\n\t\t\tgetDst().removePropertyChangeListener(nodeChangeListener);\n\t\t});\n\t}\n\n\t@Override\n\tpublic boolean equals(Object o) {\n\t\tif (this == o) return true;\n\t\tif (o == null || getClass() != o.getClass()) return false;\n\n\t\tBaseCanvasRelation other = (BaseCanvasRelation) o;\n\n\t\treturn getUuid().equals(other.getUuid());\n\t}\n\n\t@Override\n\tpublic int hashCode() {\n\t\treturn getUuid().hashCode();\n\t}\n\n\tpublic String getUuid() {\n\t\treturn (String) getAttribute(\"_uuid\");\n\t}\n\n\tpublic String getType() {\n\t\treturn (String) getAttribute(\"_type\");\n\t}\n\n\tpublic void unselect() {\n\t\taddAttribute(\"_selected\", Boolean.FALSE);\n\t\tSwingUtilities.invokeLater(() -> updatePath((Color) getAttribute(\"_defaultColor\")));\n\t}\n\n\tpublic void select() {\n\t\taddAttribute(\"_selected\", Boolean.TRUE);\n\t\tSwingUtilities.invokeLater(() -> updatePath((Color) getAttribute(\"_selectedColor\")));\n\t}\n\n\tpublic boolean isSelected() {\n\t\treturn getBooleanAttribute(\"_selected\", false);\n\t}\n\n\tprotected void unhighlight() {\n\t\taddAttribute(\"_highlight\", Boolean.FALSE);\n\t\tSwingUtilities.invokeLater(() -> updatePath(isSelected() ? (Color) getAttribute(\"_selectedColor\") : (Color) getAttribute(\"_defaultColor\")));\n\t}\n\n\tprotected void highlight() {\n\t\taddAttribute(\"_highlight\", Boolean.TRUE);\n\t\tSwingUtilities.invokeLater(() -> updatePath((Color) getAttribute(\"_highlightedColor\")));\n\t}\n\n\tprotected BaseCanvasNode<?> getSrc() {\n\t\treturn (BaseCanvasNode<?>) getAttribute(\"_src\");\n\t}\n\n\tprotected BaseCanvasNode<?> getDst() {\n\t\treturn (BaseCanvasNode<?>) getAttribute(\"_dst\");\n\t}\n\n\tpublic Long getOrder() {\n\t\treturn (Long) getAttribute(\"_order\");\n\t}\n\n\tprivate void updatePath(Color color) {\n\t\tchild.setTextPaint(color);\n\t\tsetPaint(color);\n\t\tsetStrokePaint(color);\n\t\tsetPaintInvalid(true);\n\t\tvalidateFullPaint();\n\t}\n\n\tprivate void updatePath(BaseCanvasNode<?> source, BaseCanvasNode<?> target) {\n\t\t//log.info(getUuid() + \" updatePath\");\n\t\tfinal PBounds src = source.getFullBoundsReference();\n\t\tfinal PBounds dst = target.getFullBoundsReference();\n\t\tfinal boolean horizontalOverlap = !(src.getMaxX() < dst.getMinX() || src.getMinX() > dst.getMaxX());\n\t\tfinal Point2D.Double startCenterBottom = new Point2D.Double(src.getCenterX(), src.getMaxY());\n\t\tfinal Point2D.Double endCenterTop = new Point2D.Double(dst.getCenterX(), dst.getMinY());\n\t\tfinal Point2D.Double startCenterTop = new Point2D.Double(src.getCenterX(), src.getMinY());\n\t\tfinal Point2D.Double endCenterBottom = new Point2D.Double(dst.getCenterX(), dst.getMaxY());\n\t\tif (src.getCenterX() < dst.getCenterX()) {\n\t\t\tfinal Point2D.Double startRightCenter = new Point2D.Double(src.getMaxX(), src.getCenterY());\n\t\t\tfinal Point2D.Double endRightCenter = new Point2D.Double(dst.getMinX(), dst.getCenterY());\n\t\t\tif (src.getCenterY() < dst.getCenterY()) {\n\t\t\t\tif (!horizontalOverlap) {\n\t\t\t\t\tdrawStraightPath(startRightCenter, endRightCenter);\n\t\t\t\t} else {\n\t\t\t\t\tdrawStraightPath(startCenterBottom, endCenterTop);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!horizontalOverlap) {\n\t\t\t\t\tdrawStraightPath(startRightCenter, endRightCenter);\n\t\t\t\t} else {\n\t\t\t\t\tdrawStraightPath(startCenterTop, endCenterBottom);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfinal Point2D.Double startLeftCenter = new Point2D.Double(src.getMinX(), src.getCenterY());\n\t\t\tfinal Point2D.Double endLeftCenter = new Point2D.Double(dst.getMaxX(), dst.getCenterY());\n\t\t\tif (src.getCenterY() < dst.getCenterY()) {\n\t\t\t\tif (!horizontalOverlap) {\n\t\t\t\t\tdrawStraightPath(startLeftCenter, endLeftCenter);\n\t\t\t\t} else {\n\t\t\t\t\tdrawStraightPath(startCenterBottom, endCenterTop);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!horizontalOverlap) {\n\t\t\t\t\tdrawStraightPath(startLeftCenter, endLeftCenter);\n\t\t\t\t} else {\n\t\t\t\t\tdrawStraightPath(startCenterTop, endCenterBottom);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate void drawStraightPath(Point2D start, Point2D end) {\n\t\treset();\n\t\tsetStrokePaint(child.getTextPaint());\n\t\tmoveTo(start.getX(), start.getY());\n\t\tlineTo(end.getX(), end.getY());\n\t\tchild.setOffset(getBounds().getCenter2D());\n\t\tfinal int ARR_SIZE = 4;\n\t\tfinal double dx = end.getX() - start.getX();\n\t\tfinal double dy = end.getY() - start.getY();\n\t\tfinal double angle = Math.atan2(dy, dx);\n\t\tfinal int len = (int) (Math.sqrt(dx * dx + dy * dy) - 10);\n\t\tfinal AffineTransform at = AffineTransform.getTranslateInstance(start.getX(), start.getY());\n\t\tat.concatenate(AffineTransform.getRotateInstance(angle));\n\t\tappend(new Polygon(new int[]{len,\n\t\t\t\t\tlen - ARR_SIZE,\n\t\t\t\t\tlen - ARR_SIZE,\n\t\t\t\t\tlen}, new int[]{0,\n\t\t\t\t\t-ARR_SIZE,\n\t\t\t\t\tARR_SIZE,\n\t\t\t\t\t0}, 4).getPathIterator(at), false);\n\t\tsetPaintInvalid(true);\n\t\tvalidateFullPaint();\n\t}\n\n\t@Override\n\tpublic int compare(BaseCanvasRelation o1, BaseCanvasRelation o2) {\n\t\treturn o1.getOrder().compareTo(o2.getOrder());\n\t}\n\n\tprivate final class PNodeChangeListener implements PropertyChangeListener {\n\n\t\tprivate final java.util.UUID uuid = java.util.UUID.randomUUID();\n\n\t\t@Override\n\t\tpublic boolean equals(Object o) {\n\t\t\tif (this == o) return true;\n\t\t\tif (o == null || getClass() != o.getClass()) return false;\n\t\t\tPNodeChangeListener that = (PNodeChangeListener) o;\n\t\t\treturn uuid.equals(that.uuid);\n\t\t}\n\n\t\t@Override\n\t\tpublic int hashCode() {\n\t\t\treturn java.util.Objects.hash(uuid);\n\t\t}\n\n\t\t@Override\n\t\tpublic void propertyChange(PropertyChangeEvent evt) {\n\t\t\tswitch (evt.getPropertyName()) {\n\t\t\t\tcase PNode.PROPERTY_FULL_BOUNDS:\n\t\t\t\t\tbreak;\n\t\t\t\tcase PNode.PROPERTY_TRANSFORM:\n\t\t\t\t\tSwingUtilities.invokeLater(() -> updatePath((getSrc()), getDst()));\n\t\t\t\t\tbreak;\n\t\t\t\tcase PNode.PROPERTY_PARENT:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}  \n\n\tprivate final class RelationInputEventHandler extends PBasicInputEventHandler {\n\n\t\t@Override\n\t\tpublic void mouseEntered(PInputEvent event) {\n\t\t\tevent.getInputManager().setKeyboardFocus(this);\n\t\t\thighlight();\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseExited(PInputEvent event) {\n\t\t\tunhighlight();\n\t\t\tevent.getInputManager().setKeyboardFocus(thisCanvas());\n\t\t}\n\n\t\t@Override\n\t\tpublic void mouseClicked(PInputEvent event) {\n\t\t\tif (event.isRightMouseButton()) {\n\t\t\t\tfinal JPopupMenu pop = new JPopupMenu();\n\t\t\t\tthisCanvas().setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));\n\t\t\t\tonRelationRightClick(event, pop);\n\t\t\t\tthisCanvas().setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));\n\t\t\t\tpop.show(thisCanvas(), (int) event.getCanvasPosition().getX(), (int) event.getCanvasPosition().getY());\n\t\t\t} else if (event.isLeftMouseButton()) {\n\t\t\t\tSwingUtilities.invokeLater(() -> onRelationLeftClick(event));\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void keyPressed(PInputEvent event) {\n\t\t\tonRelationKeyPressed(event);\n\t\t}\n\t}  \n\n\tprotected void onRelationRightClick(PInputEvent event, JPopupMenu pop) {\n\t}\n\n\tprotected void onRelationLeftClick(PInputEvent event) {\n\t\tif (isSelected()) unselect();\n\t\telse select();\n\t}\n\n\tprotected void onRelationKeyPressed(PInputEvent event) {\n\t}\n\n\tabstract class RelationAction extends AbstractAction {\n\n\t\tfinal PInputEvent event;\n\n\t\tRelationAction(String name, PInputEvent event) {\n\t\t\tsuper(name);\n\t\t\tthis.event = event;\n\t\t}\n\n\t\t@Override\n\t\tpublic void actionPerformed(ActionEvent e) {\n\t\t\tactionPerformed(event, e);\n\t\t}\n\n\t\tabstract void actionPerformed(PInputEvent event, ActionEvent e);\n\t}\n} ",
      "parameters" : [ ],
      "children" : [ {
        "uuid" : "1bff4c6f-bd1a-4660-8235-5339fd7107e3",
        "name" : "CanvasRelation",
        "text" : "public java.util.function.Supplier<STModelCanvas.~name~> new~name~(BaseCanvasNode<?> src, BaseCanvasNode<?> dst~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\treturn () -> new STModelCanvas.~name~(src, dst~if(uuidExpression)~~else~, uuid~endif~~if(labelExpression)~~else~, label~endif~~if(fields)~, ~fields:{it|~it.name~};separator=\", \"~~endif~);\n}\n\npublic void add~name~(BaseCanvasNode<?> src, BaseCanvasNode<?> dst~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\taddRelation(~if(uuidExpression)~~uuidExpression~~else~src.getUuid() + dst.getUuid()~endif~, new~name~(src, dst~if(uuidExpression)~~else~, src.getUuid() + dst.getUuid()~endif~~if(labelExpression)~~else~, label~endif~~if(fields)~, ~fields:{it|~it.name~};separator=\", \"~~endif~));\n}\n\nfinal class ~name~ extends BaseCanvasRelation {\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\n\tpublic ~name~(BaseCanvasNode<?> src, BaseCanvasNode<?> dst~if(uuidExpression)~~else~, String uuid~endif~~if(labelExpression)~~else~, String label~endif~~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\", \"~~endif~) {\n\t\tsuper(src, dst, ~if(uuidExpression)~~uuidExpression~~else~uuid~endif~, ~if(labelExpression)~~labelExpression~~else~label~endif~);\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n\n\t@Override\n\tprotected void onRelationRightClick(PInputEvent event, JPopupMenu pop) {\n\t\t~rightClickStatements:{it|~it~};separator=\"\\n\"~\n\n\t\t~rightClickActions:{it|pop.add(new ~it.name~(event));};separator=\"\\n\"~\n\t}\n~if(keyPressActions)~\n\t\n\t@Override\n\tprotected void onRelationKeyPressed(PInputEvent event) {\n\t\tswitch (event.getKeyCode()) {\n~keyPressActions:{it|\n\t\t\tcase VK_~it.key~:\n\t\t\t\tnew ~it.name~(event).actionPerformed(null);\n\t\t\t\tbreak;\n};separator=\"\\n\"~\n\t\t}\n\t\tsuper.onRelationKeyPressed(event);\n\t}\n~endif~\n\n\t~actions:{it|~it~};separator=\"\\n\\n\"~\n} ",
        "parameters" : [ {
          "uuid" : "9f928eac-60ce-461f-bf41-8f0345cabd59",
          "name" : "name",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "d1a977c0-e290-4e62-be03-002fb8be240b",
          "name" : "uuidExpression",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "039eb802-da45-485c-bc33-9b0e1e9bc7d9",
          "name" : "labelExpression",
          "type" : "SINGLE",
          "argumentType" : "Object"
        }, {
          "uuid" : "0162d414-75c9-4749-be20-d0ccd312e4d2",
          "name" : "fields",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "81711c46-b16c-4446-abeb-17e486ea782b",
            "name" : "type",
            "argumentType" : "Object"
          }, {
            "uuid" : "dac42f4e-8c5c-4de1-9bc4-b2e6207d7884",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "35ab009f-0994-4ab8-8d3b-8720a076b2b2",
          "name" : "rightClickStatements",
          "type" : "LIST",
          "argumentType" : "Object"
        }, {
          "uuid" : "53121434-9821-4880-89ec-0465b568e59a",
          "name" : "rightClickActions",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "dbded870-ff8c-436a-afde-bd5d15e5d3fc",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "333682e0-1124-4f7d-974b-ce8b4b49ee46",
          "name" : "keyPressActions",
          "type" : "KVLIST",
          "argumentType" : "Object",
          "keys" : [ {
            "uuid" : "4fc55a11-6c15-40d8-aee7-99d4e2357de3",
            "name" : "key",
            "argumentType" : "Object"
          }, {
            "uuid" : "c86cf623-1d06-4fc8-a2f4-86e3c54739f8",
            "name" : "name",
            "argumentType" : "Object"
          } ]
        }, {
          "uuid" : "a0f50747-d6a7-46eb-9de5-5a25841a56e8",
          "name" : "actions",
          "type" : "LIST",
          "argumentType" : "Object"
        } ],
        "children" : [ {
          "uuid" : "a87ce0f5-8f3b-4393-aa77-7f873f2307ca",
          "name" : "CanvasRelationAction",
          "text" : "final class ~name~ extends RelationAction {\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n\t\n\t~name~(PInputEvent event~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\",\"~~endif~) {\n\t\tsuper(\"~title~\", event);\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n\n\t@Override\n\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\t\t~statements:{it|~it~};separator=\"\\n\"~\n\t}\n} ",
          "parameters" : [ {
            "uuid" : "12ffdff2-3ef3-4b61-8904-2aa9ed78607b",
            "name" : "name",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "75125b24-08e2-4017-9dfd-29b2127848dd",
            "name" : "fields",
            "type" : "KVLIST",
            "argumentType" : "Object",
            "keys" : [ {
              "uuid" : "b867ffd1-2b4e-493b-a94b-ab8addd83fe9",
              "name" : "type",
              "argumentType" : "Object"
            }, {
              "uuid" : "cb2e7bef-0fac-4160-9371-5f186d21a090",
              "name" : "name",
              "argumentType" : "Object"
            } ]
          }, {
            "uuid" : "9d4f1d28-9562-4d2b-9039-ab9537c2e89d",
            "name" : "title",
            "type" : "SINGLE",
            "argumentType" : "Object"
          }, {
            "uuid" : "ae7d6b78-3021-42cc-a936-18eb0eefde6f",
            "name" : "statements",
            "type" : "LIST",
            "argumentType" : "Object"
          } ]
        } ]
      } ]
    }, {
      "uuid" : "f69bdee4-69a3-4533-b2ac-866366709929",
      "name" : "CanvasAction",
      "text" : "final class ~name~ extends CanvasAction {\n~if(fields)~\n\n\t~fields:{it|private ~it.type~ ~it.name~;};separator=\"\\n\"~\n~endif~\n\t\n\t~name~(PInputEvent event~if(fields)~, ~fields:{it|~it.type~ ~it.name~};separator=\",\"~~endif~) {\n\t\tsuper(\"~title~\", event);\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n\n\t@Override\n\tvoid actionPerformed(PInputEvent event, ActionEvent e) {\n\t\t~statements:{it|~it~};separator=\"\\n\"~\n\t}\n} ",
      "parameters" : [ {
        "uuid" : "0b662aab-d912-4d1d-9f68-b1b50077880e",
        "name" : "name",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "09d4fe5c-9940-402a-b542-2ecfe8f65b2c",
        "name" : "fields",
        "type" : "KVLIST",
        "argumentType" : "Object",
        "keys" : [ {
          "uuid" : "b344f2f6-b880-402e-ae4f-60bf2b2c922b",
          "name" : "type",
          "argumentType" : "Object"
        }, {
          "uuid" : "cab1f9fb-ff2d-41cf-b817-32d7ac2b964d",
          "name" : "name",
          "argumentType" : "Object"
        } ]
      }, {
        "uuid" : "24e452af-aac4-4067-837e-65007504aa79",
        "name" : "title",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "ac0a74cc-98e3-4594-afca-09fd30ba2f68",
        "name" : "statements",
        "type" : "LIST",
        "argumentType" : "Object"
      } ]
    } ],
    "parameters" : [ {
      "uuid" : "d0dd3b08-90ce-4d37-81a3-de4b86c459b0",
      "name" : "packageName",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "acada939-b17e-43ba-b04b-5959a2ee87e2",
      "name" : "name",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "db17ae63-3ab0-4891-91b7-bfa86c6cc02f",
      "name" : "fields",
      "type" : "KVLIST",
      "argumentType" : "Object",
      "keys" : [ {
        "uuid" : "5b10fb48-3030-498f-94f9-20067db3219c",
        "name" : "type",
        "argumentType" : "Object"
      }, {
        "uuid" : "9dfd9623-ed2a-464a-a092-705afe41299f",
        "name" : "name",
        "argumentType" : "Object"
      } ]
    }, {
      "uuid" : "589f229b-6fff-492d-bafb-6dc6d868a533",
      "name" : "constructorStatements",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "20338374-f634-43c4-9b42-9ce4435c4230",
      "name" : "methods",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "d15f511f-67e9-409d-913f-23180ba7e377",
      "name" : "rightClickStatements",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "5a52afe5-f879-40e4-b914-0744172ac6ea",
      "name" : "rightClickActions",
      "type" : "KVLIST",
      "argumentType" : "Object",
      "keys" : [ {
        "uuid" : "6e3cf74d-b0c7-4dda-abbb-20a6f8a34145",
        "name" : "name",
        "argumentType" : "Object"
      } ]
    }, {
      "uuid" : "e58039b9-f0d0-4b35-9663-d7fd3d496e25",
      "name" : "keyPressActions",
      "type" : "KVLIST",
      "argumentType" : "Object",
      "keys" : [ {
        "uuid" : "6acf524f-8caf-4e64-bbea-6e4a5c0e5421",
        "name" : "key",
        "argumentType" : "Object"
      }, {
        "uuid" : "2bf415ce-ea2a-43e2-90ef-499e2a8252fe",
        "name" : "name",
        "argumentType" : "Object"
      } ]
    }, {
      "uuid" : "861bd43b-e6cb-4d7f-8cf3-c3ba6f0d68a8",
      "name" : "actions",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "341e65f0-5582-40cb-b8cb-f403ef9add83",
      "name" : "canvasNodes",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "0516d809-8083-440d-b34d-a27c7609198d",
      "name" : "canvasRelations",
      "type" : "LIST",
      "argumentType" : "Object"
    } ]
  }, {
    "uuid" : "94abec9f-6ef2-4d9b-995f-44a09d457c18",
    "name" : "AppEvents",
    "text" : "package ~packageName~;\n\npublic class ~name~ {\n\n\tprivate final static org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(~name~.class);\n\n\t~events:{it|~it~};separator=\"\\n\\n\"~\n} ",
    "parameters" : [ {
      "uuid" : "c482571a-a9d7-4450-a318-92ce1fb1c4c9",
      "name" : "packageName",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "9fe9b57c-1123-4d43-95bb-d5eaf42dc080",
      "name" : "name",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "7b064051-876f-45f7-b424-b99b9b776e2d",
      "name" : "events",
      "type" : "LIST",
      "argumentType" : "Object"
    } ],
    "children" : [ {
      "uuid" : "c7a14ffb-fcfe-49af-9577-46af7f94671a",
      "name" : "AppEvent",
      "text" : "public static void post~name~(~fields:{it|~it.type~ ~it.name~};separator=\", \"~) {\n\tlog.info(\"post ~name~\");\n\torg.greenrobot.eventbus.EventBus.getDefault().post(new ~name~(~fields:{it|~it.name~};separator=\", \"~));\n}\n\npublic static class ~name~ {\n\n\t~fields:{it|public final ~it.type~ ~it.name~;};separator=\"\\n\"~\n\t\n\tpublic ~name~(~fields:{it|~it.type~ ~it.name~};separator=\", \"~) {\n\t\t~fields:{it|this.~it.name~ = ~it.name~;};separator=\"\\n\"~\n\t}\n} ",
      "parameters" : [ {
        "uuid" : "2a5667b9-1226-48a6-871e-0d3e0baf0a30",
        "name" : "name",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "ed5f129c-558e-42c5-8bb4-85cef7d4a9b4",
        "name" : "fields",
        "type" : "KVLIST",
        "argumentType" : "Object",
        "keys" : [ {
          "uuid" : "8b0aefc6-3f30-46c0-9cce-e7a45375368a",
          "name" : "type",
          "argumentType" : "Object"
        }, {
          "uuid" : "f2e4176b-d498-4fa1-a697-2a32e5881f4a",
          "name" : "name",
          "argumentType" : "Object"
        } ]
      } ]
    }, {
      "uuid" : "56f917ba-50b7-40e4-a444-046bec35d4dc",
      "name" : "NewOpenRemovedEvents",
      "text" : "public static void postNew~name~(~type~ ~name;format=\"lowFirst\"~) {\n\tlog.info(\"post New~name~\");\n\torg.greenrobot.eventbus.EventBus.getDefault().post(new New~name~(~name;format=\"lowFirst\"~));\n}\n\npublic static void postRemoved~name~(java.lang.String uuid) {\n\tlog.info(\"post Removed~name~\");\n\torg.greenrobot.eventbus.EventBus.getDefault().post(new Removed~name~(uuid));\n}\n\npublic static void postOpen~name~(~type~ ~name;format=\"lowFirst\"~) {\n\tlog.info(\"post Open~name~\");\n\torg.greenrobot.eventbus.EventBus.getDefault().post(new Open~name~(~name;format=\"lowFirst\"~));\n}\n\npublic static class New~name~ {\n\n\tpublic final ~type~ ~name;format=\"lowFirst\"~;\n\n\tpublic New~name~(~type~ ~name;format=\"lowFirst\"~) {\n\t\tthis.~name;format=\"lowFirst\"~ = ~name;format=\"lowFirst\"~;\n\t}\n}\n\npublic static class Removed~name~ {\n\n\tpublic final java.lang.String uuid;\n\n\tpublic Removed~name~(java.lang.String uuid) {\n\t\tthis.uuid = uuid;\n\t}\n}\n\npublic static class Open~name~ {\n\n\tpublic final ~type~ ~name;format=\"lowFirst\"~;\n\n\tpublic Open~name~(~type~ ~name;format=\"lowFirst\"~) {\n\t\tthis.~name;format=\"lowFirst\"~ = ~name;format=\"lowFirst\"~;\n\t}\n} ",
      "parameters" : [ {
        "uuid" : "231c6929-273a-4b26-ba74-9a7f8bed465e",
        "name" : "name",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "e7dee0f6-2d83-4c12-8156-6c85109ad7ea",
        "name" : "type",
        "type" : "SINGLE",
        "argumentType" : "Object"
      } ]
    }, {
      "uuid" : "1940b970-5991-484f-8fa3-e5b061b65b85",
      "name" : "EventSubscriber",
      "text" : "@org.greenrobot.eventbus.Subscribe()\npublic void on~eventName~(~eventType~ event) {\n\t~statements:{it|~it~};separator=\"\\n\"~\n} ",
      "parameters" : [ {
        "uuid" : "ecff85b3-05ab-464e-8c16-eaa629241d25",
        "name" : "eventName",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "9088b2bd-46a0-454d-b021-9cf1e6d32047",
        "name" : "eventType",
        "type" : "SINGLE",
        "argumentType" : "Object"
      }, {
        "uuid" : "d31feb12-38de-4730-903d-12cddfac2d7a",
        "name" : "statements",
        "type" : "LIST",
        "argumentType" : "Object"
      } ]
    } ]
  }, {
    "uuid" : "52c4cf0f-c4dc-451e-b9a2-80222561d727",
    "name" : "STWorkspace",
    "text" : "package ~packageName~;\n\nimport ~packageName~.domain.STGroupModel;\nimport ~packageName~.domain.STTemplate;\nimport ~packageName~.model.STModel;\n\nimport javax.swing.*;\nimport java.awt.*;\nimport java.util.Optional;\n\npublic class ~name~ extends JTabbedPane {\n\n\tprivate final STAppPresentationModel presentationModel;\n\n\tpublic ~name~(STAppPresentationModel presentationModel) {\n\t\tthis.presentationModel = presentationModel;\n\t\tsetPreferredSize(new Dimension(800, 600));\n\t\t~constructorParameters:{it|~it~};separator=\"\\n\"~\n\t}\n\n\t~methods:{it|~it~};separator=\"\\n\\n\"~\n\n\tpublic Optional<STModelCanvas> findCanvas() {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STModelCanvas)\n\t\t\t\t\treturn Optional.of((STModelCanvas) tabComponentAt);\n\t\t}\n\n\t\tfinal STModelCanvas stModelCanvas = new STModelCanvas(UIManager.getColor(\"Panel.background\"), new Dimension(800,600),presentationModel);\n\t\taddPane(\"Canvas\", stModelCanvas);\n\t\treturn Optional.of(stModelCanvas);\n\t}\n\n\tpublic STModelGrid getModelGrid(STTemplate stTemplate) {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STModelGrid) {\n\t\t\t\t\tif (((STModelGrid) tabComponentAt).getModel().equals(stTemplate))\n\t\t\t\t\t\treturn (STModelGrid) tabComponentAt;\n\t\t\t\t}\n\t\t}\n\n\t\tfinal STModelGrid stModelGrid = new STModelGrid(presentationModel, stTemplate);\n\t\taddPane(stTemplate.getName() + \"-Models\", stModelGrid);\n\t\treturn stModelGrid;\n\t}\n\n\tpublic STModelEditor getModelEditor(STTemplate stTemplate, STModel stModel) {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STModelEditor) {\n\t\t\t\t\tif (((STModelEditor) tabComponentAt).getModel().equals(stModel))\n\t\t\t\t\t\treturn (STModelEditor) tabComponentAt;\n\t\t\t\t}\n\t\t}\n\n\t\tfinal STModelEditor component = new STModelEditor(presentationModel, stModel);\n\t\taddPane(stTemplate.getName() + \"Model\", component);\n\t\treturn component;\n\t}\n\n\tpublic void removeSTEditor(STGroupModel stGroup) {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STEditor) {\n\t\t\t\t\tif (((STEditor) tabComponentAt).getModel().equals(stGroup)) {\n\t\t\t\t\t\tremove(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t}\n\n\tpublic STEditor getSTEditor(STGroupModel stGroup) {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STEditor) {\n\t\t\t\t\tif (((STEditor) tabComponentAt).getModel().equals(stGroup)) {\n\t\t\t\t\t\tfinal STEditor stEditor = (STEditor) tabComponentAt;\n\t\t\t\t\t\tstEditor.setSTTemplate(null);\n\t\t\t\t\t\tsetSelectedComponent(stEditor);\n\t\t\t\t\t\treturn stEditor;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\tfinal STEditor component = new STEditor(stGroup, presentationModel);\n\t\tcomponent.setSTTemplate(null);\n\t\taddPane(stGroup.getName(), component);\n\t\tsetSelectedComponent(component);\n\t\treturn component;\n\t}\n\n\tpublic STValueGrid getValueGrid() {\n\t\tfor (int i = 0; i < getTabCount(); i++) {\n\t\t\t\tfinal Component tabComponentAt = getComponentAt(i);\n\t\t\t\tif (tabComponentAt instanceof STValueGrid)\n\t\t\t\t\treturn (STValueGrid) tabComponentAt;\n\t\t}\n\n\t\tfinal STValueGrid component = new STValueGrid(presentationModel);\n\t\taddPane(\"Values\", component);\n\t\treturn component;\n\t}\n\n\tprivate void addPane(String title, JComponent component) {\n\t\taddTab(title, component);\n\t\tsetTabComponentAt(indexOfComponent(component), new ButtonTabComponent(this, title, component));\n\t}\n\n\tpublic void showCanvas() {\n\t\tfindCanvas().ifPresent(stModelCanvas -> SwingUtilities.invokeLater(() -> setSelectedComponent(stModelCanvas)));\n\t}\n\n\tclass ButtonTabComponent extends JPanel {\n\n\t\tButtonTabComponent(final JTabbedPane pane, String title, JComponent component) {\n\t\t\t\tsuper(new FlowLayout(FlowLayout.LEFT, 0, 0));\n\t\t\t\tsetOpaque(false);\n\n\t\t\t\tfinal JLabel label = new JLabel(title);\n\t\t\t\tlabel.setBorder(BorderFactory.createEmptyBorder(0, 0, 0, 5));\n\t\t\t\tadd(label);\n\n\t\t\t\tfinal JButton btnClose = new JButton(presentationModel.loadIcon(\"close\", \"12x12\"));\n\t\t\t\tfinal Dimension dimension = new Dimension(12, 16);\n\t\t\t\tbtnClose.setMaximumSize(dimension);\n\t\t\t\tbtnClose.setPreferredSize(dimension);\n\t\t\t\tbtnClose.setMinimumSize(dimension);\n\t\t\t\tbtnClose.setOpaque(false);\n\t\t\t\tbtnClose.setContentAreaFilled(false);\n\t\t\t\tbtnClose.setBorderPainted(false);\n\t\t\t\tbtnClose.addActionListener(e -> SwingUtilities.invokeLater(() -> pane.remove(component)));\n\t\t\t\tadd(btnClose);\n\t\t}\n\t}\n} ",
    "parameters" : [ {
      "uuid" : "5b0e673c-eab4-47d7-aa7d-449e8d1d5ca5",
      "name" : "packageName",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "ca917e95-5e41-49b1-b3c7-ef6d548e4a78",
      "name" : "name",
      "type" : "SINGLE",
      "argumentType" : "Object"
    }, {
      "uuid" : "9867b8fa-5b23-424f-bfc1-773c4a2c3bbe",
      "name" : "constructorParameters",
      "type" : "LIST",
      "argumentType" : "Object"
    }, {
      "uuid" : "d7662e19-ff6c-4d3e-9b6b-45c5a7e3c941",
      "name" : "methods",
      "type" : "LIST",
      "argumentType" : "Object"
    } ]
  } ]
}